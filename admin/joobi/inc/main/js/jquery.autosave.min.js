(function(a){a.fn.autosave=function(d){var d=a.extend({},a.fn.autosave.defaults,d);var c;var b=this;a(this).addClass("autosave");this.bind("autosave.setup",function(){d.setup.apply(b.element,[b.element,d]);a(this).trigger("autosave.record");c=setInterval(function(){a(b).trigger("autosave.save")},d.interval)}).bind("autosave.shutdown",function(){d.shutdown.apply(this.element,[this.element,d]);clearInterval(c);if(a(this).data("autosave.dirty")==true){a(this).trigger("autosave.save",[false])}a(this).removeClass("autosave").unbind("autosave");a(this).data("autosave.form",null);a(this).data("autosave.dirty",null)}).bind("autosave.reset",function(){a(this).trigger("autosave.shutdown");a(this).trigger("autosave.setup")}).bind("autosave.record",function(){d.record.apply(this.element,[this.element,d]);a(this).data("autosave.dirty",false);a(this).data("autosave.form",a(this).find(d.data).not(".autosave-ignore").serializeArray())}).bind("autosave.save",function(h,f){if(!d.before.apply(b,[b,d])){return}var g=a(this).find(d.data).not(".autosave-ignore").serializeArray();if(a.param(g)!=a.param(a(this).data("autosave.form"))&&a(this).data("autosave.active")!=true){if(!d.validate.apply(b,[b,d])){return}a(this).data("autosave.active",true);var i=function(e){a(b).data("autosave.active",false);a(b).trigger("autosave.record");d.save.apply(b,[b,d,e])};if(d.url!=undefined&&a.isFunction(d.url)){d.url.apply(b.element,[b.element,d,g,i])}else{a.ajax({async:(f==undefined)?true:f,url:(d==undefined||d.url==undefined)?a(this).attr("action"):d.url,type:"post",data:g,success:i})}}}).trigger("autosave.setup");return this};a.fn.isDirty=function(){if(a(this).data("autosave.dirty")==true){return true}else{if(a(this).data("autosave.form")==undefined){return false}return !(a.param(a(this).data("autosave.form"))==a.param(a(this).find("input,select,textarea").not(".autosave-ignore").serializeArray()))}};a.fn.autosave.defaults={data:"input,select,textarea",interval:120000,setup:function(b,c){},record:function(b,c){},before:function(b,c){return true},validate:function(b,c){return a.isFunction(a.fn.validate)&&!a(this).is(".ignore-validate")?a(this).valid():true},save:function(b,c){},shutdown:function(b,c){},dirty:function(b,c){}};window.onbeforeunload=function(){a("form.autosave").trigger("autosave.shutdown")}})(jQuery);